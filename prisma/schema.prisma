generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Property {
  id            String         @id @default(uuid()) @map("id")
  title         String         @map("title")
  price         Float          @map("price")
  description   String?        @map("description")
  imageUrl      String?        @map("imageUrl")
  status        String         @default("AVAILABLE") @map("status")
  amenities     Amenity[]
  leads         Lead[]
  propertyImages PropertyImage[]
  createdAt     DateTime       @default(now()) @map("createdAt")
  updatedAt     DateTime       @updatedAt @map("updatedAt")

  @@map("Property")
}

model Amenity {
  id         String    @id @default(uuid()) @map("id")
  name       String    @map("name")
  properties Property[]

  @@map("Amenity")
}

model Lead {
  id         String   @id @default(uuid()) @map("id")
  propertyId String   @map("propertyId")
  property   Property @relation(fields: [propertyId], references: [id])
  name       String   @map("name")
  email      String   @map("email")
  phone      String?  @map("phone")
  message    String?  @map("message")
  checkIn    DateTime? @map("checkIn")
  checkOut   DateTime? @map("checkOut")
  createdAt  DateTime @default(now()) @map("createdAt")

  @@map("Lead")
}

model PropertyImage {
  id         String   @id @default(uuid()) @map("id")
  propertyId String   @map("propertyId")
  property   Property @relation(fields: [propertyId], references: [id])
  url        String   @map("url")
  isCover    Boolean  @default(false) @map("isCover")
  createdAt  DateTime @default(now()) @map("createdAt")

  @@map("PropertyImage")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model amenities {
  id                 BigInt               @id @default(autoincrement())
  name               String               @db.VarChar(50)
  icon_key           String               @db.VarChar(50)
  property_amenities property_amenities[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model leads {
  id             BigInt       @id @default(autoincrement())
  property_id    BigInt?
  client_name    String       @db.VarChar(100)
  client_email   String       @db.VarChar(100)
  client_phone   String?      @db.VarChar(20)
  check_in_date  DateTime?    @db.Date
  check_out_date DateTime?    @db.Date
  message        String?
  status         lead_status? @default(NEW)
  created_at     DateTime     @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  properties     properties?  @relation(fields: [property_id], references: [id], onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model properties {
  id                 BigInt               @id @default(autoincrement())
  public_id          String               @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  title              String               @db.VarChar(150)
  slug               String               @unique @db.VarChar(200)
  description        String?
  price_per_night    Decimal              @db.Decimal(10, 2)
  currency           String?              @default("PEN") @db.VarChar(3)
  max_capacity       Int?
  rooms              Int?
  bathrooms          Int?
  area_m2            Decimal?             @db.Decimal(10, 2)
  address            String?              @db.VarChar(255)
  map_lat            Decimal?             @db.Decimal(10, 8)
  map_lng            Decimal?             @db.Decimal(11, 8)
  status             property_status?     @default(HIDDEN)
  created_at         DateTime             @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  deleted_at         DateTime?            @db.Timestamptz(6)
  leads              leads[]
  property_amenities property_amenities[]
  property_images    property_images[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model property_amenities {
  property_id BigInt
  amenity_id  BigInt
  amenities   amenities  @relation(fields: [amenity_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  properties  properties @relation(fields: [property_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([property_id, amenity_id])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model property_images {
  id            BigInt     @id @default(autoincrement())
  property_id   BigInt
  image_url     String     @db.VarChar(500)
  alt_text      String?    @db.VarChar(150)
  display_order Int?       @default(0)
  is_cover      Boolean?   @default(false)
  created_at    DateTime?  @default(dbgenerated("timezone('utc'::text, now())")) @db.Timestamptz(6)
  properties    properties @relation(fields: [property_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model HeroImage {
  id           String   @id @default(uuid())
  url          String
  alt          String?
  displayOrder Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())

  @@map("HeroImage")
}

enum lead_status {
  NEW
  CONTACTED
  CLOSED
}

enum property_status {
  AVAILABLE
  RENTED
  MAINTENANCE
  HIDDEN
}
